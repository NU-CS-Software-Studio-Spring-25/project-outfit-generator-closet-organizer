<h1>Clothing Items</h1>

<% if defined?(@no_results) && @no_results %>
  <div class="alert alert-warning mt-4 text-center">
    Sorry, we don't have anything in the catalog for that category.
    <%= link_to 'Return to home?', root_path, class: 'btn btn-link' %>
  </div>
<% else %>
  <% if params[:category].present? %>
    <p>
      Showing results for category: 
      <strong><%= params[:category].capitalize %></strong>
    </p>
  <% end %>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Article</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @clothings.each do |clothing| %>
        <tr>
          <td><%= clothing.name %></td>
          <td><%= clothing.brand %></td>
          <td><%= clothing.category %></td>
          <td><%= clothing.article %></td>
          <td>
            <div class="d-flex justify-content-between gap-2">
            <%= link_to 'Show', clothing_path(clothing), class: "btn btn-info" %> 
            <%= link_to 'Edit', edit_clothing_path(clothing), class: "btn btn-warning" %> 

           <% if user_signed_in? %>
            <% if current_user.outfits.any? %>
              <%= form_with url: outfit_outfit_items_path(current_user.outfits.first), method: :post, local: true do %>
                <%= hidden_field_tag :clothing_id, clothing.id %>
                  <div class="d-flex justify-content gap-2">
                    <%= select_tag :outfit_id,
                      options_from_collection_for_select(current_user.outfits, :id, :name),
                      prompt: "Select an Outfit",
                      class: "form-select form-select-sm" %>
                    <%= submit_tag "Add", class: "btn btn-success" %>
                  </div>
                <% end %>
              <%= link_to 'New Outfit', new_outfit_path, class: "btn btn-primary" %> 
            <% else %>
              <!-- Show "Create an Outfit" if no outfits exist -->
              <%= link_to 'New Outfit', new_outfit_path, class: "btn btn-primary" %> 
            <% end %>
          <% end %>


            <%= link_to 'Delete', confirm_destroy_clothing_path(clothing), class: "btn btn-danger" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div>
    <%= link_to 'New Clothing Item', new_clothing_path, class: "btn btn-primary" %>
    <%= link_to '← Back to Home', root_path, class: "btn btn-secondary" %>
  </div>
<% end %>